generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Reservation {
  id            String @id @default(cuid())
  reservationId String @unique

  chatId String?
  source String? @default("WHATSAPP")

  dateBR      String?
  dateISO     String?
  peopleCount Int?

  wantsStay   Boolean?
  suiteChoice String?

  status      String @default("PENDING_PAYMENT") // PENDING_PAYMENT | CONFIRMED | CANCELLED
  totalAmount Int    @default(1000)

  paymentToken  String?
  paymentUrl    String?
  paymentStatus String  @default("PENDING") // PENDING | CONFIRMED | FAILED

  notes String @default("")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  people  Person[]
  payment Payment? // <= RELAÇÃO EXISTE AQUI
}

model Person {
  id            String      @id @default(cuid())
  reservationId String
  reservation   Reservation @relation(fields: [reservationId], references: [reservationId], onDelete: Cascade)

  name      String
  cpf       String
  cpfMasked String
  dobBR     String
  dobISO    String

  createdAt DateTime @default(now())
}

model Payment {
  id String @id @default(cuid())

  // 1:1 com Reservation (um pagamento por reserva)
  reservationId String      @unique
  reservation   Reservation @relation(fields: [reservationId], references: [reservationId], onDelete: Cascade)

  provider        String  @default("ASAAS")
  token           String? // seu token interno (se quiser)
  asaasCustomerId String?
  asaasPaymentId  String?

  status      String  @default("PENDING") // PENDING | CONFIRMED | RECEIVED | OVERDUE | CANCELLED
  billingType String? // PIX | BOLETO | CREDIT_CARD
  amount      Int     @default(0)

  invoiceUrl  String?
  bankSlipUrl String?
  pixQrCode   String?
  pixPayload  String?

  rawWebhook String? // guarda JSON string do último webhook recebido

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
